<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ„ 2025 ì–´ì›Œì¦ˆ ê²°ê³¼ ë°œí‘œ ğŸ…</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ğŸ¨ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (íˆ¬í‘œ í˜ì´ì§€ì™€ í†µì¼) */
        body { background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); margin: 0; padding: 20px 10px; color: #fff; font-family: 'Noto Sans KR', sans-serif; min-height: 100vh; overflow-x: hidden; }
        .snowflake { position: fixed; top: -10px; color: rgba(255, 255, 255, 0.5); font-size: 1em; z-index: 0; pointer-events: none; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(110vh); } }
        .container { max-width: 600px; margin: 0 auto; text-align: center; position: relative; z-index: 10; padding-bottom: 60px; }
        h1 { font-family: 'Jua', sans-serif; font-size: 1.8rem; margin: 20px 0 5px 0; font-weight: 400; text-shadow: 0 4px 10px rgba(0,0,0,0.5); user-select: none; }
        h1 .red { color: #ff5252; } h1 .green { color: #69f0ae; } h1 .gold { color: #FFD700; cursor: pointer; } 
        .subtitle { color: #ccc; font-size: 0.9rem; margin-bottom: 20px; font-weight: 300; }
        .chart-box { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border-radius: 20px; padding: 15px; margin-bottom: 30px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 20px rgba(0,0,0,0.4); height: 300px; position: relative; }
        .category-scroll-wrapper { overflow-x: auto; white-space: nowrap; padding-bottom: 10px; margin-bottom: 10px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .category-scroll-wrapper::-webkit-scrollbar { display: none; }
        .category-nav { display: inline-flex; gap: 8px; padding: 0 5px; }
        .cat-btn { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: #ccc; padding: 8px 14px; border-radius: 20px; font-size: 0.9rem; cursor: pointer; transition: all 0.2s; flex-shrink: 0; font-family: 'Jua', sans-serif; }
        .cat-btn.active { background: #d32f2f; color: #fff; border-color: #ff5252; box-shadow: 0 0 10px rgba(255, 82, 82, 0.5); transform: scale(1.05); }
        .review-list { display: flex; flex-direction: column; gap: 15px; min-height: 200px; }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .review-card { background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 15px 20px; text-align: left; border: 1px solid rgba(255, 255, 255, 0.1); transition: transform 0.2s; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        .review-card::top { content: ''; position: absolute; top:0; left:0; width:100%; height: 3px; background: linear-gradient(90deg, #d32f2f, #2e7d32); }
        
        /* ì¹´ë“œ ë‚´ë¶€ ë ˆì´ì•„ì›ƒ */
        .card-main { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        
        /* ë­í‚¹ ê°•ì¡° */
        .review-card.rank-1 { border: 2px solid #FFD700; background: rgba(255, 215, 0, 0.15); box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); }
        .review-card.rank-2 { border: 1px solid #C0C0C0; background: rgba(192, 192, 192, 0.1); }
        .review-card.rank-3 { border: 1px solid #CD7F32; background: rgba(205, 127, 50, 0.1); }

        .card-info { flex: 1; }
        .subject-tag { font-size: 0.7rem; color: #fff; background: #2e7d32; padding: 2px 6px; border-radius: 6px; margin-right: 5px; vertical-align: middle; }
        .subject-name { font-size: 1.1rem; font-weight: 700; color: #fff; margin-bottom: 2px; vertical-align: middle; }
        .card-score { text-align: right; min-width: 80px; }
        .score-big { font-size: 1.4rem; font-weight: 900; color: #FFD700; display: block; }
        .score-sub { font-size: 0.75rem; color: #888; display: block; margin-top: 2px; }

        /* ğŸ‘‡ í•œì¤„í‰ ì˜ì—­ ìŠ¤íƒ€ì¼ (ìƒˆë¡œ ì¶”ê°€ë¨!) */
        .comments-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.3); color: #ccc;
            border-radius: 20px; padding: 5px 12px; font-size: 0.8rem; margin-top: 10px;
            cursor: pointer; align-self: flex-start; transition: all 0.2s;
        }
        .comments-btn:hover { background: rgba(255,255,255,0.1); color: #fff; border-color: #fff; }
        
        .comments-section {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            margin-top: 15px; border-top: 1px dashed rgba(255,255,255,0.1); padding-top: 10px;
            animation: slideDown 0.3s ease-out; width: 100%;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        .comment-item {
            background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 8px;
            margin-bottom: 6px; font-size: 0.9rem; color: #eee;
            display: flex; justify-content: space-between;
        }
        .comment-score { color: #FFD700; font-weight: bold; margin-left: 10px; font-size: 0.8rem; }
        .no-comments { color: #888; font-size: 0.8rem; font-style: italic; }

        .home-btn { display: inline-block; margin-top: 50px; padding: 12px 30px; border: 1px solid rgba(255,255,255,0.3); border-radius: 50px; color: #ccc; text-decoration: none; transition: all 0.3s; }
        .home-btn:hover { background: rgba(255,255,255,0.2); color: white; border-color: #fff; }
        .no-result { color: #888; margin-top: 50px; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div id="snow-container"></div>

    <div class="container">
        <h1><span class="red">The</span> <span class="gold" id="secret-btn">2025</span> <span class="green">Awards</span> ğŸ†</h1>
        <p class="subtitle">ğŸ„ ëŒ€ë§ì˜ íˆ¬í‘œ ê²°ê³¼ë¥¼ ê³µê°œí•©ë‹ˆë‹¤! ğŸ…</p>

        <div class="chart-box"><canvas id="rankingChart"></canvas></div>

        <div class="category-scroll-wrapper">
            <div class="category-nav" id="category-nav">
                <button class="cat-btn active" onclick="filterCategory('all')">ì „ì²´</button>
            </div>
        </div>

        <div class="review-list" id="review-list"></div>

        <a href="index.html" class="home-btn">ğŸ  ë©”ì¸ìœ¼ë¡œ</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // âœ… ë‚˜ì¨© í‚¤
        const firebaseConfig = {
            apiKey: "AIzaSyA_Rs8og9eT47qbYZYqBcLv6VGh0nZxumw",
            authDomain: "review-class-28dda.firebaseapp.com",
            databaseURL: "https://review-class-28dda-default-rtdb.firebaseio.com",
            projectId: "review-class-28dda",
            storageBucket: "review-class-28dda.firebasestorage.app",
            messagingSenderId: "256031114562",
            appId: "1:256031114562:web:f6d8a80f0aabd77cea34db",
            measurementId: "G-L56ETZH2RE"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ==========================================
        // â˜… ê³¼ëª© ë¦¬ìŠ¤íŠ¸ (íˆ¬í‘œ í˜ì´ì§€ì™€ ë™ì¼) â˜…
        // ==========================================
        const rawSubjects = [
             { id: 's1', name: 'ì»´í“¨í„°ì˜ì´í•´' }, { id: 's2', name: 'ìœ ë¹„ì¿¼í„°ìŠ¤ì»´í“¨íŒ…ê°œë¡ ' }, { id: 's3', name: 'íŒŒì´ì¬í”„ë¡œê·¸ë˜ë°ê¸°ì´ˆ' }, { id: 's4', name: 'ë°ì´í„°ì •ë³´ì²˜ë¦¬ì…ë¬¸' },
             { id: 's5', name: 'ì´ì‚°ìˆ˜í•™' }, { id: 's6', name: 'Javaí”„ë¡œê·¸ë˜ë°' }, { id: 's7', name: 'HTML5ì›¹í”„ë¡œê·¸ë˜ë°' },
             { id: 's8', name: 'ê·¸ë˜í”½ì»¤ë®¤ë‹ˆì¼€ì´ì…˜' }, { id: 's9', name: 'ë°ì´í„°ë² ì´ìŠ¤ì‹œìŠ¤í…œ' }, { id: 's10', name: 'ë””ì§€í„¸ë…¼ë¦¬íšŒë¡œ' }, { id: 's11', name: 'ìš´ì˜ì²´ì œ' }, { id: 's12', name: 'ì¸ê³µì§€ëŠ¥' }, { id: 's13', name: 'ì•Œê³ ë¦¬ì¦˜' },
             { id: 's14', name: 'ì»´í“¨í„°ê·¸ë˜í”½ìŠ¤' }, { id: 's15', name: 'ëª¨ë°”ì¼ì•±í”„ë¡œê·¸ë˜ë°' }, { id: 's16', name: 'ì»´í“¨í„°ë³´ì•ˆ' }, { id: 's17', name: 'ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™' }, { id: 's18', name: 'ì •ë³´í†µì‹ ë§' },
             { id: 's19', name: 'ì»´í“¨í„°ê³¼í•™ê°œë¡ ' }, { id: 's20', name: 'ë©€í‹°ë¯¸ë””ì–´ì‹œìŠ¤í…œ' }, { id: 's21', name: 'Cí”„ë¡œê·¸ë˜ë°' },
             { id: 's22', name: 'ëŒ€í•™ìˆ˜í•™ì˜ì´í•´' }, { id: 's23', name: 'ì˜¤í”ˆì†ŒìŠ¤ê¸°ë°˜ë°ì´í„°ë¶„ì„' }, { id: 's24', name: 'ìë£Œêµ¬ì¡°' }, { id: 's25', name: 'ì„ í˜•ëŒ€ìˆ˜' }, { id: 's26', name: 'í”„ë¡œê·¸ë˜ë°ì–¸ì–´ë¡ ' },
             { id: 's27', name: 'ì»´í“¨í„°êµ¬ì¡°' }, { id: 's28', name: 'JSPí”„ë¡œê·¸ë˜ë°' }, { id: 's29', name: 'UNIXì‹œìŠ¤í…œ' }, { id: 's30', name: 'ì‹œë®¬ë ˆì´ì…˜' }, { id: 's31', name: 'ë¨¸ì‹ ëŸ¬ë‹' },
             { id: 's32', name: 'í´ë¼ìš°ë“œì»´í“¨íŒ…' }, { id: 's33', name: 'ì»´íŒŒì¼ëŸ¬êµ¬ì„±' }, { id: 's34', name: 'ë”¥ëŸ¬ë‹' }, { id: 's35', name: 'ë¹…ë°ì´í„°ì˜ì´í•´ì™€í™œìš©' }
        ];

        function getChosung(str) {
            const chosung = ["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
            const code = str.charCodeAt(0) - 44032;
            if (code < 0 || code > 11171) {
                if (/[a-zA-Z]/.test(str[0])) return 'A-Z';
                return 'ê¸°íƒ€';
            }
            return chosung[Math.floor(code / 588)];
        }
        const subjects = rawSubjects.map(sub => ({ ...sub, chosung: getChosung(sub.name) }));

        const navContainer = document.getElementById('category-nav');
        const activeCategories = [...new Set(subjects.map(s => s.chosung))].sort();
        if(activeCategories.includes('A-Z')) {
             activeCategories.push(activeCategories.splice(activeCategories.indexOf('A-Z'), 1)[0]);
        }
        activeCategories.forEach(cat => {
            const btn = document.createElement('button');
            btn.className = 'cat-btn';
            btn.innerText = cat;
            btn.onclick = () => filterCategory(cat);
            navContainer.appendChild(btn);
        });

        const listContainer = document.getElementById('review-list');
        let currentCategory = 'all';
        let myChart = null;
        let dbVotes = {}; 
        let dbComments = {};

        function render() {
            listContainer.innerHTML = '';
            
            let allData = subjects.map(sub => {
                let total = 0, count = 0;
                if(dbVotes[sub.id]) {
                    total = dbVotes[sub.id].total;
                    count = dbVotes[sub.id].count;
                }
                const avg = count === 0 ? 0 : (total / count).toFixed(2);
                return { ...sub, avg: parseFloat(avg), count: count };
            });

            allData.sort((a, b) => b.avg - a.avg);

            const rankMap = {};
            allData.forEach((item, index) => { rankMap[item.id] = index + 1; });

            const filtered = allData.filter(sub => currentCategory === 'all' || sub.chosung === currentCategory);
            
            if(filtered.length === 0) {
                listContainer.innerHTML = '<div class="no-result">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                filtered.forEach(sub => {
                    const rank = rankMap[sub.id];
                    let rankClass = '', badge = '';
                    if(rank === 1) { rankClass = 'rank-1'; badge = 'ğŸ¥‡ 1ìœ„'; }
                    else if(rank === 2) { rankClass = 'rank-2'; badge = 'ğŸ¥ˆ 2ìœ„'; }
                    else if(rank === 3) { rankClass = 'rank-3'; badge = 'ğŸ¥‰ 3ìœ„'; }

                    const card = document.createElement('div');
                    card.className = `review-card ${rankClass}`;
                    
                    // í•œì¤„í‰ ê°€ì ¸ì˜¤ê¸°
                    const commentsObj = dbComments[sub.id] || {};
                    const commentsArr = Object.values(commentsObj).reverse(); // ìµœì‹ ìˆœ
                    const commentCount = commentsArr.length;

                    card.innerHTML = `
                        <div class="card-main">
                            <div class="card-info">
                                <div><span class="subject-tag">${sub.chosung}</span><span class="subject-name">${badge} ${sub.name}</span></div>
                            </div>
                            <div class="card-score">
                                <span class="score-big">â­ ${sub.avg}</span>
                                <span class="score-sub">(${sub.count}ëª…)</span>
                            </div>
                        </div>
                        
                        <button class="comments-btn" onclick="toggleComments('${sub.id}')">ğŸ’¬ í•œì¤„í‰ ë³´ê¸° (${commentCount})</button>
                        
                        <div id="comments-${sub.id}" class="comments-section">
                            ${ commentsArr.length > 0 
                                ? commentsArr.map(c => `
                                    <div class="comment-item">
                                        <span>${c.text}</span>
                                        <span class="comment-score">â˜…${c.score}</span>
                                    </div>`).join('') 
                                : '<div class="no-comments">ì•„ì§ ë“±ë¡ëœ í•œì¤„í‰ì´ ì—†ìŠµë‹ˆë‹¤.</div>' 
                            }
                        </div>
                    `;
                    listContainer.appendChild(card);
                });
            }
            updateChart(allData);
        }

        window.toggleComments = function(id) {
            const el = document.getElementById(`comments-${id}`);
            if (el.style.display === "block") {
                el.style.display = "none";
            } else {
                el.style.display = "block";
            }
        }

        window.filterCategory = function(cat) {
            currentCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(btn => {
                if((cat === 'all' && btn.innerText === 'ì „ì²´') || btn.innerText === cat) btn.classList.add('active');
                else btn.classList.remove('active');
            });
            render();
        }

        function updateChart(allData) {
            const ctx = document.getElementById('rankingChart').getContext('2d');
            const topData = allData.slice(0, 7); 
            const labels = topData.map(s => s.name);
            const dataPoints = topData.map(s => s.avg);
            const colors = ['#FFD700', '#d32f2f', '#388e3c', '#d32f2f', '#388e3c', '#d32f2f', '#388e3c'];

            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: labels, datasets: [{ label: 'í‰ì ', data: dataPoints, backgroundColor: colors, borderRadius: 8, barThickness: 15 }] },
                options: { indexAxis: 'y', scales: { x: { beginAtZero: true, max: 5, ticks: { color: '#aaa', font: {size:10} }, grid: { color: 'rgba(255,255,255,0.05)' } }, y: { ticks: { color: '#fff', font: { size: 11 }, autoSkip: false }, grid: { display: false } } }, plugins: { legend: { display: false } }, maintainAspectRatio: false, responsive: true, animation: { duration: 1000 } }
            });
        }

        // ğŸ”¥ DB ì‹¤ì‹œê°„ ê°ì§€ (ì ìˆ˜)
        const votesRef = ref(db, 'votes');
        onValue(votesRef, (snapshot) => {
            dbVotes = snapshot.val() || {};
            render();
        });

        // ğŸ”¥ DB ì‹¤ì‹œê°„ ê°ì§€ (í•œì¤„í‰) - ì—¬ê¸°ê°€ ì¶”ê°€ë¨!
        const commentsRef = ref(db, 'comments');
        onValue(commentsRef, (snapshot) => {
            dbComments = snapshot.val() || {};
            render(); // ì½”ë©˜íŠ¸ ì—…ë°ì´íŠ¸ ì‹œ í™”ë©´ ê°±ì‹ 
        });

        // ë¹„ë°€ ë²„íŠ¼
        let clickCount = 0;
        document.getElementById('secret-btn').addEventListener('click', () => {
            clickCount++;
            if (clickCount === 5) {
                clickCount = 0;
                const nameInput = prompt("ğŸ… ê´€ë¦¬ì ëª¨ë“œ: ê³¼ëª©ëª… ì¼ë¶€ ì…ë ¥");
                if(!nameInput) return;
                const target = subjects.find(s => s.name.includes(nameInput));
                if(target) {
                    const newScore = prompt(`'${target.name}' ìƒˆ ì ìˆ˜ (0~5)`);
                    if(newScore) {
                        const scoreRef = ref(db, 'votes/' + target.id);
                        runTransaction(scoreRef, () => { return { total: parseFloat(newScore) * 10, count: 10 }; });
                        alert("ë°˜ì˜ ì™„ë£Œ! ğŸ„");
                    }
                }
            }
        });

        function createSnow() {
            const container = document.getElementById('snow-container');
            for(let i=0; i<40; i++){
                const snow = document.createElement('div');
                snow.className = 'snowflake';
                snow.innerHTML = 'â„';
                snow.style.left = Math.random() * 100 + 'vw';
                snow.style.animationDuration = Math.random() * 5 + 5 + 's'; 
                container.appendChild(snow);
            }
        }
        createSnow();
    </script>
</body>
</html>
