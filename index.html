<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ ë°©í†µëŒ€ ì»´ê³¼ íƒ€ìì™• ì„ ë°œì „ ğŸ„</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet"> 
    <style>
        /* CSS: í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í…Œë§ˆ ë””ìì¸ ë° í°íŠ¸ ì ìš© */
        body { 
            font-family: 'Noto Sans KR', sans-serif;
            text-align: center; 
            padding: 20px; 
            background-color: #f0f8ff; 
        }
        .container { 
            max-width: 850px; 
            margin: 20px auto; 
            background: #ffffff; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 8px 16px rgba(0,0,0,0.2); 
            border: 5px dashed #a00000; 
            border-image: repeating-linear-gradient(45deg, #a00000, #a00000 10px, #006400 10px, #006400 20px) 5;
        }
        h1 { 
            color: #a00000; 
            font-size: 2.5em;
            text-shadow: 1px 1px 2px #006400; 
        }
        p, .info-panel p { 
            color: #006400; 
            font-weight: bold;
            font-size: 1.1em;
            margin: 5px 0;
        }
        #target-text { 
            font-size: 1.3em; 
            border: 3px solid #006400; 
            padding: 25px; 
            margin-bottom: 20px; 
            text-align: left; 
            background-color: #ffeaea; 
            line-height: 1.8; 
            border-radius: 8px; 
            min-height: 80px; /* ë¬¸ì¥ì´ ì—†ì„ ë•Œë„ ê³µê°„ ìœ ì§€ */
        }
        #typing-input { 
            width: 90%; 
            padding: 15px; 
            font-size: 1.2em; 
            border: 3px solid #a00000; 
            border-radius: 8px; 
            margin-bottom: 20px; 
        }
        .correct { background-color: #d4edda; color: #155724; }
        .incorrect { background-color: #f8d7da; color: #721c24; }
        .highlight-current { background-color: gold; } 
        #result { 
            margin-top: 30px; 
            padding: 15px;
            font-size: 1.5em; 
            font-weight: bold; 
            color: #a00000; 
            border: 2px solid #006400;
            border-radius: 5px;
            background-color: #f9f9f9;
            min-height: 50px;
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê·¸ë£¹ */
        .btn-group {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        button {
            background-color: #006400; 
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover { background-color: #004d00; }
        
        /* ì´ˆê¸°í™” ë²„íŠ¼ ì „ìš© ìŠ¤íƒ€ì¼ (ë¹¨ê°„ìƒ‰) */
        .reset-rank-btn {
            background-color: #dc3545;
        }
        .reset-rank-btn:hover {
            background-color: #c82333;
        }

        /* ë­í‚¹ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        #ranking-table {
            width: 90%;
            margin: 30px auto 0;
            border-collapse: collapse;
            font-size: 1em;
        }
        #ranking-table th, #ranking-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        #ranking-table th {
            background-color: #a00000;
            color: white;
        }
        #ranking-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .rank-1 { background-color: gold !important; color: black; font-weight: bold; }
        .rank-2 { background-color: silver !important; color: black; font-weight: bold; }
        .rank-3 { background-color: #cd7f32 !important; color: white; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ„ ë°©í†µëŒ€ ì»´ê³¼ íƒ€ìì™• ì„ ë°œì „ ğŸ</h1>
        <p>ì•„ë˜ ë¬¸ì¥ì„ ì •í™•í•˜ê³  ë¹ ë¥´ê²Œ ì…ë ¥í•´ë³´ì„¸ìš”! (ë‹¤ì‹œ ì‹œì‘í•˜ë©´ ë¬¸ì¥ì´ ë°”ë€ë‹ˆë‹¤)</p>

        <div id="target-text"></div>
        <textarea id="typing-input" rows="5" placeholder="ì—¬ê¸°ì— ì…ë ¥ì„ ì‹œì‘í•˜ì„¸ìš”..."></textarea>
        
        <div class="info-panel">
            <p>ê²½ê³¼ ì‹œê°„: <span id="timer">0.00</span>ì´ˆ</p>
            <p>í˜„ì¬ íƒ€ìˆ˜ (CPM): <span id="current-cpm">0</span>íƒ€</p> 
            <p>ì •í™•ë„: <span id="accuracy">100</span>%</p>
            <p>ì˜¤íƒ€ ìˆ˜: <span id="error-count">0</span>ê°œ</p> 
        </div>
        
        <div id="result"></div>
        
        <!-- ë²„íŠ¼ ê·¸ë£¹ -->
        <div class="btn-group">
            <button onclick="resetTest()">ë‹¤ì‹œ ì‹œì‘</button>
            <button onclick="resetRanking()" class="reset-rank-btn">ë­í‚¹ ì´ˆê¸°í™”</button>
        </div>

        <hr style="margin-top: 30px; border-color: #ccc;">

        <h2>ğŸ‘‘ í˜„ì¬ ë­í‚¹ ìˆœìœ„í‘œ ğŸ‘‘</h2>
        <table id="ranking-table">
            <thead>
                <tr>
                    <th>ìˆœìœ„</th>
                    <th>ë‹‰ë„¤ì„</th>
                    <th>íƒ€ìˆ˜ (CPM)</th>
                    <th>ì •í™•ë„ (%)</th>
                    <th>ì‹œê°„ (ì´ˆ)</th>
                    <th>ì˜¤íƒ€ ìˆ˜</th>
                </tr>
            </thead>
            <tbody id="ranking-body">
                <!-- ë­í‚¹ ë°ì´í„°ê°€ ì—¬ê¸°ì— ë“¤ì–´ì˜µë‹ˆë‹¤ -->
            </tbody>
        </table>

    </div>

    <script>
        // JavaScript: íƒ€ì ì¸¡ì • ë° ë­í‚¹ ë¡œì§
        const targetTextElement = document.getElementById('target-text');
        const typingInput = document.getElementById('typing-input');
        const timerElement = document.getElementById('timer');
        const accuracyElement = document.getElementById('accuracy');
        const currentCpmElement = document.getElementById('current-cpm');
        const errorCountElement = document.getElementById('error-count');
        const resultElement = document.getElementById('result');
        const rankingBody = document.getElementById('ranking-body');

        // ëŒ€íšŒì— ì‚¬ìš©í•  ë¬¸ì¥
        const targetSentences = [
            "ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤! ë°©í†µëŒ€ ì»´ê³¼ ì—°ë§ ëª¨ì„ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ë¶‰ì€ìƒ‰ê³¼ ì´ˆë¡ìƒ‰ ì¡°ëª…ì²˜ëŸ¼ ìš°ë¦¬ì˜ ì•ë‚ ë„ ë¹›ë‚˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤. íƒ€ìì™• ìƒí’ˆì€ ë”°ëœ»í•œ ì»¤í”¼ ì¿ í°ì…ë‹ˆë‹¤!",
            "ì˜¬ í•œ í•´ ì»´í“¨í„°ê³¼í•™ê³¼ì—ì„œ ì—´ì‹¬íˆ ì½”ë”©í•˜ê³  ê³µë¶€í•˜ëŠë¼ ìˆ˜ê³  ë§ì•˜ìŠµë‹ˆë‹¤. ì´ì œ ë§›ìˆëŠ” ìŒì‹ê³¼ í•¨ê»˜ ì¦ê±°ìš´ íœ´ì‹ ì‹œê°„ì„ ê°€ì§‘ì‹œë‹¤. ì‚°íƒ€ê°€ ì½”ë“œë¥¼ ë²„ê·¸ ì—†ì´ ì£¼ê¸¸ ë°”ë¼ë©°!",
            "í”„ë¡ íŠ¸ì—”ë“œ, ë°±ì—”ë“œ, ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¡°í™”ê°€ ì™„ë²½í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“­ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ìœµí•© ì§€ì‹ì„ ê°–ì¶˜ ìë‘ìŠ¤ëŸ¬ìš´ ë°©í†µëŒ€ ì»´ê³¼ í•™ìƒë“¤ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ìµœê³ ì˜ ê¸°ë¡ì— ë„ì „í•˜ì„¸ìš”!"
        ];
        
        let targetText;
        let startTime;
        let timerInterval;
        let isTypingStarted = false;

        // í…ìŠ¤íŠ¸ ì´ˆê¸°í™” í•¨ìˆ˜
        function initText() {
            const randomIndex = Math.floor(Math.random() * targetSentences.length);
            targetText = targetSentences[randomIndex];

            targetTextElement.innerHTML = targetText.split('').map(char => `<span>${char}</span>`).join('');
            typingInput.value = '';
            timerElement.textContent = '0.00';
            accuracyElement.textContent = '100';
            currentCpmElement.textContent = '0';
            errorCountElement.textContent = '0';
            resultElement.textContent = '';
            typingInput.disabled = false;
            isTypingStarted = false;
            
            clearInterval(timerInterval);
            
            if (targetTextElement.children.length > 0) {
                 targetTextElement.children[0].classList.add('highlight-current');
            }
            typingInput.focus();
            loadRanking(); // ë­í‚¹ ë¡œë“œ
        }

        // ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ (ì´ë¦„ ë§¤ì¹­)
        function resetTest() {
            initText();
        }

        // íƒ€ì´ë¨¸ ì‹œì‘ ë° ì‹¤ì‹œê°„ CPM ì—…ë°ì´íŠ¸
        function startTimer() {
            startTime = new Date().getTime();
            timerInterval = setInterval(() => {
                const currentTime = new Date().getTime();
                const elapsedTime = (currentTime - startTime) / 1000;
                timerElement.textContent = elapsedTime.toFixed(2);
                updateRealtimeCpm(elapsedTime); 
            }, 100); 
        }
        
        // ì‹¤ì‹œê°„ CPM ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateRealtimeCpm(elapsedTimeInSeconds) {
             const currentInput = typingInput.value;
             
             if (elapsedTimeInSeconds > 0 && currentInput.length > 0) {
                const currentCpm = (currentInput.length / (elapsedTimeInSeconds / 60)).toFixed(0);
                currentCpmElement.textContent = currentCpm;
            } else {
                 currentCpmElement.textContent = '0';
            }
        }

        // ì…ë ¥ ì´ë²¤íŠ¸ ì²˜ë¦¬
        typingInput.addEventListener('input', (e) => {
            const currentInput = e.target.value;

            // 1. íƒ€ì´ë¨¸ ì‹œì‘
            if (!isTypingStarted) {
                startTimer();
                isTypingStarted = true;
            }

            // 2. ì…ë ¥ê°’ ë¹„êµ ë° ìŠ¤íƒ€ì¼, ì˜¤íƒ€ ì¹´ìš´íŠ¸ ì ìš©
            let correctChars = 0;
            let currentErrors = 0;
            const targetChars = targetTextElement.children;
            
            for (let i = 0; i < targetChars.length; i++) {
                const targetCharSpan = targetChars[i];
                
                targetCharSpan.classList.remove('highlight-current');
                if (i === currentInput.length && i < targetChars.length) {
                     targetCharSpan.classList.add('highlight-current');
                }
                
                if (i < currentInput.length) {
                    if (currentInput[i] === targetText[i]) {
                        targetCharSpan.className = 'correct';
                        correctChars++;
                    } else {
                        targetCharSpan.className = 'incorrect';
                        currentErrors++;
                    }
                } else {
                    targetCharSpan.className = '';
                }
            }

            // 3. ì •í™•ë„ ë° ì˜¤íƒ€ ì¹´ìš´íŠ¸ í‘œì‹œ
            const accuracy = ((correctChars / currentInput.length) * 100) || 100;
            accuracyElement.textContent = accuracy.toFixed(0);
            errorCountElement.textContent = currentErrors;

            // 4. í…ŒìŠ¤íŠ¸ ì™„ë£Œ ì²´í¬ ë° ë­í‚¹ ì €ì¥
            if (currentInput.length === targetText.length) {
                clearInterval(timerInterval);
                const finalTime = parseFloat(timerElement.textContent);
                const totalChars = targetText.length;
                const cpm = Math.floor(totalChars / (finalTime / 60)); // íƒ€ìˆ˜ëŠ” ì •ìˆ˜ë¡œ

                resultElement.innerHTML = `
                    ğŸ‰ **íƒ€ìì™• ë“±ê·¹!** ğŸ‰<br>
                    ìµœì¢… íƒ€ìˆ˜ (CPM): **${cpm}íƒ€**<br>
                    ì •í™•ë„: <strong>${accuracy.toFixed(0)}%</strong> (${currentErrors}ê°œ ì˜¤íƒ€)
                `;
                
                typingInput.disabled = true;
                
                // ë‹‰ë„¤ì„ ì…ë ¥ ë° ë­í‚¹ ì €ì¥!
                // ì•½ê°„ì˜ ì§€ì—°ì„ ì£¼ì–´ ê²°ê³¼ê°€ ë³´ì¸ ë’¤ ì•Œë¦¼ì°½ì´ ëœ¨ê²Œ í•¨
                setTimeout(() => {
                    saveRanking(cpm, accuracy, finalTime, currentErrors);
                }, 100);
            }
        });

        // ===================================
        // ë­í‚¹ ì €ì¥ ë° ë¡œë“œ ë¡œì§ (Local Storage)
        // ===================================

        // ë­í‚¹ ì €ì¥ í•¨ìˆ˜
        function saveRanking(cpm, accuracy, time, errors) {
            const nickname = prompt("ê¸°ë¡ì„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:");
            
            if (nickname && nickname.trim() !== '') {
                const score = {
                    nickname: nickname.substring(0, 10), // ë‹‰ë„¤ì„ 10ê¸€ì ì œí•œ
                    cpm: cpm,
                    accuracy: accuracy.toFixed(0),
                    time: time.toFixed(2),
                    errors: errors,
                    date: new Date().toLocaleString()
                };

                let ranking = JSON.parse(localStorage.getItem('typingRanking')) || [];
                ranking.push(score);
                
                // íƒ€ìˆ˜ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬
                ranking.sort((a, b) => b.cpm - a.cpm);

                localStorage.setItem('typingRanking', JSON.stringify(ranking));
                loadRanking(); // í…Œì´ë¸” ê°±ì‹ 
            }
        }

        // ë­í‚¹ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
        function loadRanking() {
            const ranking = JSON.parse(localStorage.getItem('typingRanking')) || [];
            rankingBody.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

            // íƒ€ìˆ˜ ë†’ì€ ìˆœ, íƒ€ìˆ˜ê°€ ê°™ìœ¼ë©´ ì •í™•ë„ ë†’ì€ ìˆœ ì •ë ¬
            ranking.sort((a, b) => {
                if (b.cpm !== a.cpm) return b.cpm - a.cpm;
                return b.accuracy - a.accuracy;
            });

            ranking.forEach((score, index) => {
                const row = document.createElement('tr');
                
                // 1, 2, 3ë“± ê°•ì¡° í´ë˜ìŠ¤ ì¶”ê°€
                let rankClass = '';
                if (index === 0) rankClass = 'rank-1';
                else if (index === 1) rankClass = 'rank-2';
                else if (index === 2) rankClass = 'rank-3';

                row.innerHTML = `
                    <td class="${rankClass}">${index + 1}</td>
                    <td>${score.nickname}</td>
                    <td>${score.cpm}</td>
                    <td>${score.accuracy}</td>
                    <td>${score.time}</td>
                    <td>${score.errors}</td>
                `;
                rankingBody.appendChild(row);
            });
        }

        // [ì¶”ê°€ë¨] ë­í‚¹ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetRanking() {
            if (confirm("âš ï¸ ì •ë§ë¡œ ëª¨ë“  ë­í‚¹ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ê¸°ë¡ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
                localStorage.removeItem('typingRanking');
                loadRanking(); // í™”ë©´ ê°±ì‹ 
                alert("ë­í‚¹ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²Œì„ ì´ˆê¸°í™” ì‹¤í–‰
        window.onload = initText;

    </script>
</body>
</html>