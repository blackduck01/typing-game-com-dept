<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ„ íƒ€ììœ„ë„ˆ ì„ ë°œì „ ğŸ…</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet"> 
    <style>
        /* â„ï¸ ì „ì²´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ (í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë°¤) */
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            text-align: center; 
            margin: 0;
            padding: 20px; 
            background: radial-gradient(circle at center, #1a2a6c, #b21f1f, #fdbb2d); /* í™”ë ¤í•œ ë°°ê²½ */
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); /* ê²¨ìš¸ ë°¤ */
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ëˆˆì†¡ì´ íš¨ê³¼ */
        .snowflake {
            position: fixed;
            top: -10px;
            color: #fff;
            font-size: 1em;
            text-shadow: 0 0 5px #fff;
            z-index: 1;
            user-select: none;
            pointer-events: none;
            animation: fall linear infinite;
        }
        @keyframes fall { to { transform: translateY(110vh); } }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ (ìœ ë¦¬ íš¨ê³¼) */
        .container { 
            max-width: 850px; 
            margin: 40px auto; 
            background: rgba(255, 255, 255, 0.95); 
            padding: 40px; 
            border-radius: 20px; 
            border: 4px solid #d40000;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.3), 0 0 50px rgba(0, 255, 0, 0.2);
            position: relative;
            z-index: 10;
        }

        h1 { 
            color: #d40000; 
            text-shadow: 2px 2px 0 #006400; 
            font-size: 2.5rem; 
            margin-bottom: 10px;
            animation: titleBounce 2s infinite;
        }
        @keyframes titleBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* ì½¤ë³´ ì¹´ìš´í„° */
        #combo-box {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            font-weight: 900;
            color: #ff9800;
            opacity: 0;
            transform: scale(0.5);
            transition: transform 0.1s;
        }
        .combo-active { opacity: 1 !important; transform: scale(1.2) !important; text-shadow: 0 0 10px gold; }

        /* íƒ€ì ì…ë ¥ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        #target-text { 
            font-size: 1.5em; 
            border: 3px solid #006400; 
            padding: 25px; 
            margin-bottom: 25px; 
            text-align: left; 
            background-color: #fffaf0; 
            border-radius: 15px; 
            min-height: 80px; 
            line-height: 1.6;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        #target-text span { position: relative; transition: color 0.2s; }
        
        /* í˜„ì¬ ì…ë ¥í•´ì•¼ í•  ê¸€ì ê°•ì¡° */
        .highlight-current { 
            background-color: #ffd700; 
            border-radius: 3px; 
            box-shadow: 0 0 10px #ffd700;
            font-weight: bold;
            transform: scale(1.1);
            display: inline-block;
        }

        .correct { color: #28a745; font-weight: bold; text-shadow: 0 0 5px #28a745; }
        .incorrect { color: #dc3545; text-decoration: underline; text-decoration-style: wavy; font-weight: bold; }

        #typing-input { 
            width: 90%; 
            padding: 15px; 
            font-size: 1.3em; 
            border: 3px solid #d40000; 
            border-radius: 15px; 
            margin-bottom: 20px; 
            outline: none;
            transition: box-shadow 0.3s;
        }
        #typing-input:focus { box-shadow: 0 0 15px rgba(212, 0, 0, 0.5); }

        /* í”ë“¤ë¦¼ íš¨ê³¼ (ì˜¤íƒ€ ë‚¬ì„ ë•Œ) */
        .shake { animation: shake 0.4s; }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        /* ì •ë³´ íŒ¨ë„ */
        .info-panel {
            display: flex;
            justify-content: space-around;
            background: #f1f1f1;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #333;
        }
        .info-item span { font-size: 1.2em; color: #d40000; }

        #result { 
            margin-top: 20px; 
            font-size: 1.8em; 
            font-weight: 900; 
            color: #d40000; 
            min-height: 50px;
            text-shadow: 1px 1px 0 #fff;
        }
        
        .btn-group { margin-top: 30px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        button, .link-btn { 
            background: linear-gradient(145deg, #006400, #004d00);
            color: white; border: none; padding: 12px 25px; 
            font-size: 1.1em; font-weight: bold; border-radius: 50px; 
            cursor: pointer; text-decoration: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        button:hover, .link-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
        .reset-rank-btn { background: linear-gradient(145deg, #dc3545, #b02a37); }
        .home-btn { background: linear-gradient(145deg, #a00000, #800000) !important; }

        /* íŒŒí‹°í´ íš¨ê³¼ */
        .particle {
            position: absolute;
            pointer-events: none;
            animation: fadeOut 1s forwards;
        }
        @keyframes fadeOut {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(0); opacity: 0; }
        }

        /* ë­í‚¹ í…Œì´ë¸” */
        #ranking-table { width: 100%; margin: 30px auto 0; border-collapse: separate; border-spacing: 0; border-radius: 10px; overflow: hidden; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        #ranking-table th { background-color: #a00000; color: white; padding: 12px; }
        #ranking-table td { background-color: white; border-bottom: 1px solid #eee; padding: 10px; }
        #ranking-table tr:last-child td { border-bottom: none; }
        #ranking-table tr:hover td { background-color: #ffeaea; }
    </style>
</head>
<body>
    
    <div id="snow-container"></div>

    <div class="container">
        <div id="combo-box">0 COMBO!</div>

        <h1>âŒ¨ï¸ ğŸ„ íƒ€ìì™• ì„ ë°œì „ ğŸ… âŒ¨ï¸</h1>
        <p style="color: #006400; font-weight: bold;">ì‚°íƒ€ë³´ë‹¤ ë¹ ë¥´ê²Œ! ë£¨ëŒí”„ë³´ë‹¤ ì •í™•í•˜ê²Œ!</p>

        <div id="target-text"></div>
        <textarea id="typing-input" rows="3" placeholder="ì¤€ë¹„ë˜ì…¨ë‚˜ìš”? ì—¬ê¸°ë¥¼ í´ë¦­í•˜ê³  ì‹œì‘í•˜ì„¸ìš”!"></textarea>
        
        <div class="info-panel">
            <div class="info-item">â±ï¸ ì‹œê°„: <span id="timer">0.00</span>ì´ˆ</div>
            <div class="info-item">âš¡ íƒ€ìˆ˜: <span id="current-cpm">0</span>íƒ€</div>
            <div class="info-item">ğŸ¯ ì •í™•ë„: <span id="accuracy">100</span>%</div>
            </div>
        
        <div id="result"></div>
        
        <div class="btn-group">
            <button onclick="initText()">ğŸ”„ ë‹¤ì‹œ ë„ì „</button>
            <button onclick="resetRanking()" class="reset-rank-btn">ğŸ—‘ï¸ ë­í‚¹ ì´ˆê¸°í™”</button>
            <a href="index.html" class="link-btn home-btn">ğŸ  ë©”ì¸ìœ¼ë¡œ</a>
        </div>

        <hr style="margin: 30px 0; border: 1px dashed #ccc;">
        
        <h3 style="color:#d40000;">ğŸ‘‘ ëª…ì˜ˆì˜ ì „ë‹¹ ğŸ‘‘</h3>
        <table id="ranking-table">
            <thead>
                <tr><th>ìˆœìœ„</th><th>ë‹‰ë„¤ì„</th><th>íƒ€ìˆ˜</th><th>ì •í™•ë„</th></tr>
            </thead>
            <tbody id="ranking-body"></tbody>
        </table>
    </div>

    <script>
        // ============================
        // 1. ëˆˆ ë‚´ë¦¬ëŠ” íš¨ê³¼ Script
        // ============================
        function createSnow() {
            const snowContainer = document.getElementById('snow-container');
            const count = 50; 
            for(let i=0; i<count; i++){
                const snow = document.createElement('div');
                snow.className = 'snowflake';
                snow.innerHTML = 'â„';
                snow.style.left = Math.random() * 100 + 'vw';
                snow.style.animationDuration = Math.random() * 3 + 2 + 's'; 
                snow.style.opacity = Math.random();
                snow.style.fontSize = Math.random() * 20 + 10 + 'px';
                snowContainer.appendChild(snow);
            }
        }
        createSnow();

        // ============================
        // 2. íƒ€ì ê²Œì„ ë¡œì§
        // ============================
        const targetTextElement = document.getElementById('target-text');
        const typingInput = document.getElementById('typing-input');
        const timerElement = document.getElementById('timer');
        const accuracyElement = document.getElementById('accuracy');
        const currentCpmElement = document.getElementById('current-cpm');
        const resultElement = document.getElementById('result');
        const rankingBody = document.getElementById('ranking-body');
        const comboBox = document.getElementById('combo-box');
        const container = document.querySelector('.container');

        const targetSentences = [
            "ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤! ë°©í†µëŒ€ ì»´ê³¼ ì—°ë§ ëª¨ì„ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.",
            "ë£¨ëŒí”„ ì½”ê°€ ë§¤ìš° ë°˜ì§ì´ëŠ” ì´ìœ ëŠ” ë””ë²„ê¹… ì¤‘ì´ë¼ì„œ ê·¸ë ‡ìŠµë‹ˆë‹¤.",
            "ì˜¬ í•œ í•´ ì—ëŸ¬ì™€ ì‹¸ìš°ëŠë¼ ê³ ìƒ ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤. ë‚´ë…„ì—” ë¬´ì—ëŸ¬ ê¸°ì›!",
            "ì‚°íƒ€ í• ì•„ë²„ì§€ëŠ” ì•Œê³  ê³„ì‹ ëŒ€ ëˆ„ê°€ ì½”ë”©ì„ ì˜í•˜ëŠ”ì§€ ëª»í•˜ëŠ”ì§€.",
            "í–‰ë³µí•œ ì—°ë§ ë³´ë‚´ì‹œê³  ë‚´ë…„ì—ë„ ì¦ê±°ìš´ ì½”ë”© ë¼ì´í”„ ë˜ì„¸ìš”!",
            "í•˜ì–€ ëˆˆì´ ë‚´ë ¤ì™€ ì˜¨ ì„¸ìƒì„ í•˜ì–—ê²Œ ë®ì–´ì£¼ëŠ” í™”ì´íŠ¸ í¬ë¦¬ìŠ¤ë§ˆìŠ¤",
            "ì§•ê¸€ë²¨ ì§•ê¸€ë²¨ ìš¸ë¦¬ëŠ” ì¢…ì†Œë¦¬ë§Œí¼ ìš°ë¦¬ì˜ íƒ€ì ì†Œë¦¬ë„ ê²½ì¾Œí•©ë‹ˆë‹¤."
        ];
        
        let targetText, startTime, timerInterval, isTypingStarted = false;
        let combo = 0; // ì½¤ë³´ ì¹´ìš´íŠ¸

        function initText() {
            targetText = targetSentences[Math.floor(Math.random() * targetSentences.length)];
            targetTextElement.innerHTML = targetText.split('').map(char => `<span>${char}</span>`).join('');
            typingInput.value = '';
            timerElement.textContent = '0.00';
            accuracyElement.textContent = '100';
            currentCpmElement.textContent = '0';
            resultElement.textContent = '';
            typingInput.disabled = false;
            isTypingStarted = false;
            combo = 0;
            updateCombo(0);
            
            clearInterval(timerInterval);
            if (targetTextElement.children.length > 0) targetTextElement.children[0].classList.add('highlight-current');
            typingInput.focus();
            loadRanking();
        }

        function startTimer() {
            startTime = new Date().getTime();
            timerInterval = setInterval(() => {
                const elapsed = (new Date().getTime() - startTime) / 1000;
                timerElement.textContent = elapsed.toFixed(2);
                if (elapsed > 0 && typingInput.value.length > 0) {
                    currentCpmElement.textContent = (typingInput.value.length / (elapsed / 60)).toFixed(0);
                }
            }, 100); 
        }

        // ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        typingInput.addEventListener('input', (e) => {
            if (!isTypingStarted) { startTimer(); isTypingStarted = true; }
            
            const currentInput = e.target.value;
            let correctChars = 0;
            const targetChars = targetTextElement.children;
            const lastCharIndex = currentInput.length - 1;

            // í˜„ì¬ ì…ë ¥í•œ ê¸€ìê°€ ë§ëŠ”ì§€ í™•ì¸ (ì½¤ë³´ ë° ì´í™íŠ¸ìš©)
            if (currentInput.length > 0) {
                if (currentInput[lastCharIndex] === targetText[lastCharIndex]) {
                    // ë§ì•˜ì„ ë•Œ
                    createSparkle(); // íŒŒí‹°í´ íš¨ê³¼
                    combo++;
                    updateCombo(combo);
                } else {
                    // í‹€ë ¸ì„ ë•Œ
                    combo = 0;
                    updateCombo(0);
                    container.classList.add('shake'); // í™”ë©´ í”ë“¤ë¦¼
                    setTimeout(() => container.classList.remove('shake'), 400);
                }
            } else {
                combo = 0;
                updateCombo(0);
            }

            // ì „ì²´ í…ìŠ¤íŠ¸ ë¹„êµ ë° ìƒ‰ìƒ ë³€ê²½
            let currentErrors = 0;
            for (let i = 0; i < targetChars.length; i++) {
                targetChars[i].classList.remove('highlight-current');
                
                // ì»¤ì„œ ìœ„ì¹˜ ê°•ì¡°
                if (i === currentInput.length) targetChars[i].classList.add('highlight-current');
                
                if (i < currentInput.length) {
                    if (currentInput[i] === targetText[i]) {
                        targetChars[i].className = 'correct'; 
                        correctChars++;
                    } else {
                        targetChars[i].className = 'incorrect'; 
                        currentErrors++;
                    }
                } else { 
                    targetChars[i].className = ''; 
                }
            }

            // ì •í™•ë„ ê³„ì‚°
            const accuracy = ((correctChars / currentInput.length) * 100) || 100;
            accuracyElement.textContent = accuracy.toFixed(0);

            // ê²Œì„ ì¢…ë£Œ ì¡°ê±´
            if (currentInput.length === targetText.length) {
                clearInterval(timerInterval);
                const finalTime = parseFloat(timerElement.textContent);
                const cpm = Math.floor(targetText.length / (finalTime / 60));
                
                resultElement.innerHTML = `ğŸ‰ ëŒ€ë‹¨í•´ìš”! ${cpm}íƒ€ / ì •í™•ë„ ${accuracy.toFixed(0)}%`;
                typingInput.disabled = true;
                
                launchConfetti(); // í­ì£½ ë°œì‚¬!
                setTimeout(() => saveRanking(cpm, accuracy, finalTime), 500);
            }
        });

        // ì½¤ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateCombo(count) {
            comboBox.innerText = count + " COMBO!";
            if(count > 2) {
                comboBox.classList.add('combo-active');
                // ì½¤ë³´ê°€ ëŠ˜ì–´ë‚  ë•Œë§ˆë‹¤ í…ìŠ¤íŠ¸ê°€ íŠ€ì–´ì˜¤ë¥´ëŠ” íš¨ê³¼
                comboBox.style.transform = 'scale(1.5)';
                setTimeout(() => comboBox.style.transform = 'scale(1)', 100);
            } else {
                comboBox.classList.remove('combo-active');
            }
        }

        // íŒŒí‹°í´(ê¸ˆê°€ë£¨) íš¨ê³¼ í•¨ìˆ˜
        function createSparkle() {
            const inputRect = typingInput.getBoundingClientRect();
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            // ìƒ‰ìƒ ëœë¤ (ê¸ˆìƒ‰, ë¹¨ê°•, ì´ˆë¡)
            const colors = ['#FFD700', '#FF0000', '#008000'];
            particle.style.color = colors[Math.floor(Math.random() * colors.length)];
            particle.innerHTML = 'âœ¦'; // ë³„ ëª¨ì–‘
            
            // ìœ„ì¹˜: ì…ë ¥ì°½ ì£¼ë³€ ëœë¤
            particle.style.left = (inputRect.left + Math.random() * inputRect.width) + 'px';
            particle.style.top = (inputRect.top + Math.random() * 30) + 'px';
            particle.style.fontSize = Math.random() * 20 + 10 + 'px';
            
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 1000);
        }

        // ë­í‚¹ ì €ì¥
        function saveRanking(cpm, accuracy, time) {
            const nickname = prompt("ğŸ† ê¸°ë¡ ë‹¬ì„±! ëª…ì˜ˆì˜ ì „ë‹¹ì— ì˜¬ë¦´ ë‹‰ë„¤ì„ì€?");
            if (nickname) {
                let ranking = JSON.parse(localStorage.getItem('typingRanking')) || [];
                ranking.push({ nickname, cpm, accuracy: accuracy.toFixed(0) });
                ranking.sort((a, b) => b.cpm - a.cpm);
                localStorage.setItem('typingRanking', JSON.stringify(ranking));
                loadRanking();
            }
        }

        function loadRanking() {
            const ranking = JSON.parse(localStorage.getItem('typingRanking')) || [];
            rankingBody.innerHTML = ranking.slice(0, 10).map((r, i) => { // ìƒìœ„ 10ëª…ë§Œ
                let medal = '';
                if(i===0) medal = 'ğŸ¥‡ ';
                else if(i===1) medal = 'ğŸ¥ˆ ';
                else if(i===2) medal = 'ğŸ¥‰ ';
                return `<tr><td>${medal}${i+1}</td><td>${r.nickname}</td><td>${r.cpm}</td><td>${r.accuracy}%</td></tr>`;
            }).join('');
        }

        function resetRanking() {
            if(confirm("ëª¨ë“  ë­í‚¹ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) { 
                localStorage.removeItem('typingRanking'); 
                loadRanking(); 
            }
        }

        // í­ì£½ íš¨ê³¼ (ì„±ê³µ ì‹œ)
        function launchConfetti() {
            const colors = ['#ff0000', '#00ff00', '#ffd700', '#ffffff'];
            for(let i=0; i<100; i++) {
                const p = document.createElement('div');
                p.style.position = 'fixed';
                p.style.left = '50%';
                p.style.top = '50%';
                p.style.width = '10px';
                p.style.height = '10px';
                p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                p.style.zIndex = '9999';
                document.body.appendChild(p);
                
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 300 + 100;
                
                p.animate([
                    { transform: 'translate(0,0)', opacity: 1 },
                    { transform: `translate(${Math.cos(angle)*velocity}px, ${Math.sin(angle)*velocity}px)`, opacity: 0 }
                ], {
                    duration: 1500,
                    easing: 'ease-out'
                }).onfinish = () => p.remove();
            }
        }

        window.onload = initText;
    </script>
</body>
</html>
