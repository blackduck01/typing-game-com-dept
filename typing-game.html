<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒ€ìì™• ì„ ë°œì „</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet"> 
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; text-align: center; padding: 20px; background-color: #f0f8ff; }
        .container { max-width: 850px; margin: 20px auto; background: #ffffff; padding: 30px; border-radius: 15px; border: 5px dashed #a00000; }
        h1 { color: #a00000; text-shadow: 1px 1px 2px #006400; }
        #target-text { font-size: 1.3em; border: 3px solid #006400; padding: 20px; margin-bottom: 20px; text-align: left; background-color: #ffeaea; border-radius: 8px; min-height: 80px; }
        #typing-input { width: 90%; padding: 15px; font-size: 1.2em; border: 3px solid #a00000; border-radius: 8px; margin-bottom: 20px; }
        .correct { background-color: #d4edda; color: #155724; }
        .incorrect { background-color: #f8d7da; color: #721c24; }
        .highlight-current { background-color: gold; } 
        #result { margin-top: 20px; font-size: 1.5em; font-weight: bold; color: #a00000; min-height: 50px; }
        
        .btn-group { margin-top: 20px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        button, .link-btn { background-color: #006400; color: white; border: none; padding: 10px 20px; font-size: 1.1em; font-weight: bold; border-radius: 5px; cursor: pointer; text-decoration: none; }
        button:hover, .link-btn:hover { background-color: #004d00; }
        .reset-rank-btn { background-color: #dc3545; }
        
        /* ë©”ì¸ìœ¼ë¡œ ê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ë¹¨ê°„ìƒ‰) */
        .home-btn { background-color: #a00000 !important; } 
        .home-btn:hover { background-color: #800000 !important; }

        /* ë­í‚¹ í…Œì´ë¸” */
        #ranking-table { width: 90%; margin: 30px auto; border-collapse: collapse; }
        #ranking-table th, #ranking-table td { border: 1px solid #ddd; padding: 10px; }
        #ranking-table th { background-color: #a00000; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âŒ¨ï¸ íƒ€ìì™• ì„ ë°œì „ âŒ¨ï¸</h1>
        <p style="color: #006400; font-weight: bold;">ë¬¸ì¥ì„ ë¹ ë¥´ê³  ì •í™•í•˜ê²Œ ì…ë ¥í•˜ì„¸ìš”!</p>

        <div id="target-text"></div>
        <textarea id="typing-input" rows="5" placeholder="ì—¬ê¸°ì— ì…ë ¥ì„ ì‹œì‘í•˜ì„¸ìš”..."></textarea>
        
        <div class="info-panel">
            <p>ì‹œê°„: <span id="timer">0.00</span>ì´ˆ | íƒ€ìˆ˜: <span id="current-cpm">0</span>íƒ€</p> 
            <p>ì •í™•ë„: <span id="accuracy">100</span>% | ì˜¤íƒ€: <span id="error-count">0</span>ê°œ</p> 
        </div>
        
        <div id="result"></div>
        
        <div class="btn-group">
            <a href="index.html" class="link-btn home-btn">ğŸ  ë©”ì¸ìœ¼ë¡œ</a>
            
            <button onclick="initText()">ë‹¤ì‹œ ì‹œì‘</button>
            <button onclick="resetRanking()" class="reset-rank-btn">ë­í‚¹ ì´ˆê¸°í™”</button>
        </div>

        <hr>
        <h3>ğŸ‘‘ ëª…ì˜ˆì˜ ì „ë‹¹ ğŸ‘‘</h3>
        <table id="ranking-table">
            <thead>
                <tr><th>ìˆœìœ„</th><th>ë‹‰ë„¤ì„</th><th>íƒ€ìˆ˜</th><th>ì •í™•ë„</th></tr>
            </thead>
            <tbody id="ranking-body"></tbody>
        </table>
    </div>

    <script>
        const targetTextElement = document.getElementById('target-text');
        const typingInput = document.getElementById('typing-input');
        const timerElement = document.getElementById('timer');
        const accuracyElement = document.getElementById('accuracy');
        const currentCpmElement = document.getElementById('current-cpm');
        const errorCountElement = document.getElementById('error-count');
        const resultElement = document.getElementById('result');
        const rankingBody = document.getElementById('ranking-body');

        const targetSentences = [
            "ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤! ë°©í†µëŒ€ ì»´ê³¼ ì—°ë§ ëª¨ì„ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.",
            "ë¶‰ì€ìƒ‰ê³¼ ì´ˆë¡ìƒ‰ ì¡°ëª…ì²˜ëŸ¼ ìš°ë¦¬ì˜ ì•ë‚ ë„ ë¹›ë‚˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.",
            "ì˜¬ í•œ í•´ ì»´í“¨í„°ê³¼í•™ê³¼ì—ì„œ ì—´ì‹¬íˆ ì½”ë”©í•˜ê³  ê³µë¶€í•˜ëŠë¼ ìˆ˜ê³  ë§ì•˜ìŠµë‹ˆë‹¤.",
            "í”„ë¡ íŠ¸ì—”ë“œ, ë°±ì—”ë“œ, ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¡°í™”ê°€ ì™„ë²½í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“­ë‹ˆë‹¤.",
            "ì‚°íƒ€ í• ì•„ë²„ì§€ê°€ ì½”ë“œë¥¼ ë²„ê·¸ ì—†ì´ ì„ ë¬¼í•´ì£¼ê¸¸ ë°”ëë‹ˆë‹¤!"
        ];
        
        let targetText, startTime, timerInterval, isTypingStarted = false;

        function initText() {
            targetText = targetSentences[Math.floor(Math.random() * targetSentences.length)];
            targetTextElement.innerHTML = targetText.split('').map(char => `<span>${char}</span>`).join('');
            typingInput.value = '';
            timerElement.textContent = '0.00';
            accuracyElement.textContent = '100';
            currentCpmElement.textContent = '0';
            errorCountElement.textContent = '0';
            resultElement.textContent = '';
            typingInput.disabled = false;
            isTypingStarted = false;
            clearInterval(timerInterval);
            if (targetTextElement.children.length > 0) targetTextElement.children[0].classList.add('highlight-current');
            typingInput.focus();
            loadRanking();
        }

        function startTimer() {
            startTime = new Date().getTime();
            timerInterval = setInterval(() => {
                const elapsed = (new Date().getTime() - startTime) / 1000;
                timerElement.textContent = elapsed.toFixed(2);
                if (elapsed > 0 && typingInput.value.length > 0) {
                    currentCpmElement.textContent = (typingInput.value.length / (elapsed / 60)).toFixed(0);
                }
            }, 100); 
        }

        typingInput.addEventListener('input', (e) => {
            if (!isTypingStarted) { startTimer(); isTypingStarted = true; }
            const currentInput = e.target.value;
            let correctChars = 0, currentErrors = 0;
            const targetChars = targetTextElement.children;

            for (let i = 0; i < targetChars.length; i++) {
                targetChars[i].classList.remove('highlight-current');
                if (i === currentInput.length) targetChars[i].classList.add('highlight-current');
                
                if (i < currentInput.length) {
                    if (currentInput[i] === targetText[i]) {
                        targetChars[i].className = 'correct'; correctChars++;
                    } else {
                        targetChars[i].className = 'incorrect'; currentErrors++;
                    }
                } else { targetChars[i].className = ''; }
            }

            const accuracy = ((correctChars / currentInput.length) * 100) || 100;
            accuracyElement.textContent = accuracy.toFixed(0);
            errorCountElement.textContent = currentErrors;

            if (currentInput.length === targetText.length) {
                clearInterval(timerInterval);
                const cpm = Math.floor(targetText.length / (parseFloat(timerElement.textContent) / 60));
                resultElement.innerHTML = `ğŸ‰ ì™„ë£Œ! íƒ€ìˆ˜: ${cpm}íƒ€ / ì •í™•ë„: ${accuracy.toFixed(0)}%`;
                typingInput.disabled = true;
                setTimeout(() => saveRanking(cpm, accuracy, parseFloat(timerElement.textContent)), 100);
            }
        });

        function saveRanking(cpm, accuracy, time) {
            const nickname = prompt("ê¸°ë¡ ì €ì¥! ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”:");
            if (nickname) {
                let ranking = JSON.parse(localStorage.getItem('typingRanking')) || [];
                ranking.push({ nickname, cpm, accuracy: accuracy.toFixed(0) });
                ranking.sort((a, b) => b.cpm - a.cpm);
                localStorage.setItem('typingRanking', JSON.stringify(ranking));
                loadRanking();
            }
        }

        function loadRanking() {
            const ranking = JSON.parse(localStorage.getItem('typingRanking')) || [];
            rankingBody.innerHTML = ranking.map((r, i) => 
                `<tr><td>${i+1}</td><td>${r.nickname}</td><td>${r.cpm}</td><td>${r.accuracy}%</td></tr>`
            ).join('');
        }

        function resetRanking() {
            if(confirm("ë­í‚¹ì„ ì´ˆê¸°í™”í• ê¹Œìš”?")) { localStorage.removeItem('typingRanking'); loadRanking(); }
        }

        window.onload = initText;
    </script>
</body>
</html>
